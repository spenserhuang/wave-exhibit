<!DOCTYPE html>
<html>
<head>
    <title>TopCodes Example</title>
    <link rel="stylesheet" type="text/css" href="../css/normalize.css">
    <link rel="stylesheet" type="text/css" href="../css/input.css">
    <script type='text/javascript' src='../js/persist-min.js'></script>
    <script type='text/javascript' src='../js/topcodes.js'></script>
    <script type='text/javascript' src='../js/store.js'></script>
</head>

<body>
    <h1>Set Your Wave</h1>
    <div id="instructions" class="content">
        <h2>Instructions</h2>
        <p>According to the National Ocean Service, a tidal wave is defined as a “shallow water wave caused by the gravitational interactions between the Sun, Moon, and Earth.” Tidal waves (or tides) specifically refer to the waves that are caused by the gravitational pulls of the sun and the moon. Colloquially, tsunamis are referred to as tidal waves; however, this is incorrect as tsunamis are caused by tectonic activity, underwater earthquakes, or even landslides. The sudden upward or downward movement of the seafloor during such earthquakes create large tsunami waves as large amounts of energy is suddenly released into the water, displacing huge amounts of water.</p>
    </div>
    <div id="canvas-container" class="content">
        <canvas id="video-canvas" width="650" height="500" style="background: #212121;"></canvas>
    </div>

    <div id="set-wave" class="content">
        <h2>Set the Wavelength & Amplitude of Your Wave</h2>
        <button id="camera-button" onclick="TopCodes.startStopVideoScan('video-canvas')">Start / Stop</button>
        <br>
        <br>
        <br>
        <h2>Choose Your Wave</h2>
        <select>
          <option value="tsunami">Tsunami Wave</option>
          <option value="tidal">Tidal Wave</option>
        </select>
        <br>
        <br>
        <br>
        <br>
        <br>
        <a href="measure.html">
            <div class="wrapper">
                <button>
                    Let's Go!
                </button>
            </div>
        </a>
    </div>



    <script src="../js/topcodes.js"></script>

    <script>
        // register a callback function with the TopCode library
        TopCodes.setVideoFrameCallback("video-canvas", function(jsonString) {

        // convert the JSON string to an object
        var json = JSON.parse(jsonString);

        // get the list of topcodes from the JSON object
        var topcodes = json.topcodes;

        // obtain a drawing context from the <canvas>
        var ctx = document.querySelector("#video-canvas").getContext('2d');
        var ctx2 = document.querySelector("#video-canvas").getContext('2d');


        var verticalDistance = 0;
        var horizontalDistance = 0;

        // draw a circle over the top of each TopCode
        ctx.fillStyle = "rgba(255, 0, 0, 0.3)";   // very translucent red
        for (i=0; i<topcodes.length; i++) {
            for (j=0; j<topcodes.length; j++) {
                    if (topcodes[i].code == 55 && topcodes[j].code == 31) {
                        ctx.beginPath();
                        ctx.arc(topcodes[i].x, topcodes[i].y, topcodes[i].radius, 0, Math.PI*2, true);
                        ctx.arc(topcodes[j].x, topcodes[j].y, topcodes[j].radius, 0, Math.PI*2, true);
                        ctx.fill();
                        console.log(Math.abs(topcodes[j].y - topcodes[i].y));
                        verticalDistance = Math.abs(topcodes[j].y - topcodes[i].y);
                        store.set('vert', verticalDistance.toString());
                    }
                }
            }

        ctx2.fillStyle = "rgba(0, 255, 0, 0.3)";   // very translucent green
        for (i=0; i<topcodes.length; i++) {
            for (j=0; j<topcodes.length; j++) {
                    if (topcodes[i].code == 79 && topcodes[j].code == 93) {
                        ctx2.beginPath();
                        ctx2.arc(topcodes[i].x, topcodes[i].y, topcodes[i].radius, 0, Math.PI*2, true);
                        ctx2.arc(topcodes[j].x, topcodes[j].y, topcodes[j].radius, 0, Math.PI*2, true);
                        ctx2.fill();
                        console.log(Math.abs(topcodes[j].x - topcodes[i].x));
                        horizontalDistance = Math.abs(topcodes[j].x - topcodes[i].x);
                        store.set('hori', horizontalDistance.toString());
                    }
                }
            }

        });
    </script>
</body>
</html>

